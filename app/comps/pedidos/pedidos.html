<div ng-include="'comps/common/topbar.html'">

</div>

<div class="modal fade" id="addPedidoModal" tabindex="-1" role="dialog" aria-labelledby="addPedidoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background: #399CDF;color: white; font-weight: bold;">
        <h5 class="modal-title" id="addPedidoModalLabel">CREAR PEDIDO <i class="fas fa-1x fa-list-alt"></i></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
        
          <form>
            
          <div class="container">

            <div ng-show="!hasClient">
              <div class="row">
                <div class="col-sm-12 col-md-6 col-lg-6">
                  <label for="clientes">Busqueda por cliente</label>
                  <div class="input-group mb-3">           
                    <input type="text" id="clientes" class="form-control" ng-model="nombre_cliente" placeholder="Busqueda por Cliente" aria-label="Busqueda por Cliente" aria-describedby="basic-addon2">
                    <div class="input-group-append">
                      <button class="btn btn-outline-secondary"  ng-click="getClientNew(true)" type="button">Buscar</button>
                    </div>
                  </div>
                </div>
                <div class="col-sm-12 col-md-6 col-lg-6" ng-show="clientes.length > 0" >
                  <div class="form-group">
                    <label for="exampleFormControlSelect1">Seleccione</label>
                    <select class="form-control" ng-model="clientIndex" id="exampleFormControlSelect1" ng-change="selectCLient()">
                      <option value="">Seleccione un cliente</option>
                      <option ng-repeat="x in clientes" value="{{$index}}">{{x.nombre_cliente}}</option>
                    </select>
                  </div>
                </div>
      
  
              </div>
            
            <div class="row">
              <div class="col-sm-12 col-md-4 col-lg-4">
                <div class="form-group">
                  <label>No_cia</label>
                  <input type="text" ng-disabled="true" ng-model="pedido.no_cia" class="form-control" placeholder="no_cia">
                </div>
              </div>
              <div class="col-sm-12 col-md-4 col-lg-4">
                <div class="form-group">
                  <label>Grupo</label>
                  <input type="text"  ng-disabled="true" ng-model="pedido.grupo" class="form-control" placeholder="Grupo">
                </div>
              </div>
              <div class="col-sm-12 col-md-4 col-lg-4">
                <div class="form-group">
                  <label>Cliente</label>
                  <input type="text" ng-disabled="true"  ng-model="pedido.no_cliente" class="form-control" placeholder="no_cliente">
                </div>
              </div>
              
            </div>
            </div>

          <div class="row">
            <div class="col-sm-12 col-md-6 col-lg-6" style="display: none;">
              <div class="form-group">
                <label>Factura</label>
                <input type="text" ng-model="pedido.no_factu" class="form-control" placeholder="no_factura">
              </div>
            </div>
            <div class="col-sm-12 col-md-4 col-lg-4">
              <div class="form-group">
                <label>Fecha</label>
                <input type="date" ng-disabled="true" ng-model="pedido.fecha" class="form-control" placeholder="fecha">
              </div>
            </div>
            <div class="col-sm-12 col-md-8 col-lg-8">


              <div class="form-group">
                <label for="comment">Observacion:</label>
                <textarea class="form-control" ng-model="pedido.observacion" rows="2" id="comment"></textarea>
              </div>
            </div>


          </div>
          
          <div class="row"  >
            
              <div class="col-sm-12 col-md-6 col-lg-6">
                <label for="clientes">Busqueda por producto</label>
                <div class="input-group mb-3">
                  <input type="text" class="form-control"  ng-model="busqueda_prod" placeholder="Busqueda por Producto" aria-label="Busqueda por Producto" aria-describedby="basic-addon2">
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary"   ng-click="getProdNew(true)" type="button">Buscar</button>
                  </div>
                </div>
              
              </div>
              <div class="col-sm-12 col-md-6 col-lg-6" ng-show="productos.length > 0">
                <div class="form-group">
                  <label for="exampleFormControlSelect2">Seleccione un producto</label>
                  <select class="form-control"  ng-model="productIndex" id="exampleFormControlSelec2" ng-change="selectProduct()">
                    <option value="" disabled selected="selected" >Seleccione</option>
                    <option ng-repeat="x in productos" ng-if="!($index==1)" value="{{$index}}">{{x.nombre_producto}} - (<sub style="font-size: 6px;">{{ x.princ_activo.toLowerCase() }}</sub>) </option>
                  </select>
                </div>
              </div>
  
           
            

            
          </div>
          
          </div>
          <div class="container"   >
            <div class="row" >
              
              

                <div class="col-2">
                  <label>Codigo</label>
                  <input type="text" ng-disabled="true" ng-model="articulo.COD_PRODUCTO" class="form-control" placeholder="no_arti">
                </div>
                <div class="col-2">
                  <label>Cantidad</label>
                  <input type="number" " min="1" max="{{articulo.existencia}}" ng-model="articulo.CANTIDAD" class="form-control" placeholder="cantidad" onkeypress='return event.charCode >= 48 && event.charCode <= 57' >
                </div>
                <div class="col-2">
                  <label>Existencia</label>
                  <input type="text"ng-disabled="true" ng-model="articulo.existencia" class="form-control" placeholder="existencia">
                </div>
                <div class="col-3">
                  <label>Precio por unidad</label>
                  <span >{{formato(2,(articulo.PRECIO)? articulo.PRECIO:0)}}</span>
                  
                </div>
                <div class="col-3">
                  <label>Precio producto total</label>
                  <span >{{formato(2,(articulo.PRECIO)? (articulo.PRECIO  * articulo.CANTIDAD):0)}}</span>
                  
                </div>
                <div class="col-12">
                  <label></label>
                  <button type="button" class="btn btn-success" style="margin-top: 32px;" ng-click="addArtPedido();">Agregar</button>
                </div>

            </div>
          
          </div>
          <div class="container" style="margin-top: 32px;">
            
            <div class="col-6 col-sm-6 col-md-6 col-lg-6" ng-show="productIndex != -1">
              <label> Total </label>
              <h4> > {{ nuevoTotal() }}</h4>
            </div>
            
            <div class="form-group">
              <table class="table">
                  <thead>
                      <tr>
                      <th scope="col"><p class="text-center">#</p></th>
                      <th  scope="col"><p class="text-center">Opcion</p></th>
                      <th scope="col"><p class="text-center">Codigo de Articulo</p></th>
                      <th scope="col"><p class="text-center">Cantidad</p></th>
                      <th scope="col"><p class="text-center">Precio por unidad</p></th>
                      <th scope="col"><p class="text-center">Total</p></th>
                      </tr>
                  </thead>
                  <tbody>
  
                      <tr ng-repeat="x in pedido.pedido">
                          <th scope="row">{{ $index + 1 }}</td>
                          <td > 
                            <!-- <button type="button" class="btn btn-danger" ng-click="removeArt($index);">X</button> -->
                            <p class="text-center">
                              <i class="fa fa-trash" style="cursor: pointer;" ng-click="removeArt($index);"></i>
                            </p>
                            
                            
                          </td>
                          <td><p class="text-center">{{ x.COD_PRODUCTO }}</p></td>
                          <td><p class="text-center">{{ x.CANTIDAD }}</p></td>
                          <td><p class="text-right">{{ formato(2,x.PRECIO) }}</p></td>
                          <td><p class="text-right">{{ formato(2,(x.PRECIO * x.CANTIDAD)) }}</p></td>
                        </tr>
                  </tbody>
                  </table>
  
            </div>
<!--   
            <div class="col-4 mb-5">
              <label></label>
              <button type="button"  class="btn btn-info" style="margin-top: 32px;" ng-click="addPedido();">Enviar pedido</button>
            </div> -->
  
          </div>
  
  
  
          </form>
  
        </div>
      </div>
      <div class="modal-footer" style="display: block;margin: 0 auto;">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" ng-click="reset();">Cerrar</button>
        <button type="button"  class="btn btn-success"  ng-click="addPedido();">Enviar pedido</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="showPedidoModal" tabindex="-1" role="dialog" aria-labelledby="showPedidoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background: #399CDF;color: white; font-weight: bold;">
        <h5 class="modal-title" id="addPedidoModalLabel">VER PEDIDO <i class="fas fa-1x fa-list-alt"></i></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
        
          <form>
            
          <div class="container">

            <div ng-show="!hasClient">
              <div class="row">
                <div class="col-sm-12 col-md-6 col-lg-6">
                  <label for="clientes">Busqueda por cliente</label>
                  <div class="input-group mb-3">           
                    <input type="text" id="clientes" class="form-control" ng-model="nombre_cliente" placeholder="Busqueda por Cliente" aria-label="Busqueda por Cliente" aria-describedby="basic-addon2">
                    <div class="input-group-append">
                      <button class="btn btn-outline-secondary"  ng-click="getClientNew(true)" type="button">Buscar</button>
                    </div>
                  </div>
                </div>
                <div class="col-sm-12 col-md-6 col-lg-6" ng-show="clientes.length > 0" >
                  <div class="form-group">
                    <label for="exampleFormControlSelect1">Seleccione</label>
                    <select class="form-control" ng-model="clientIndex" id="exampleFormControlSelect1" ng-change="selectCLient()">
                      <option value="">Seleccione un cliente</option>
                      <option ng-repeat="x in clientes" value="{{$index}}">{{x.nombre_cliente}}</option>
                    </select>
                  </div>
                </div>
      
  
              </div>
            
            <div class="row">
              <div class="col-sm-12 col-md-4 col-lg-4">
                <div class="form-group">
                  <label>No_cia</label>
                  <input type="text" ng-disabled="true" ng-model="pedido.no_cia" class="form-control" placeholder="no_cia">
                </div>
              </div>
              <div class="col-sm-12 col-md-4 col-lg-4">
                <div class="form-group">
                  <label>Grupo</label>
                  <input type="text"  ng-disabled="true" ng-model="pedido.grupo" class="form-control" placeholder="Grupo">
                </div>
              </div>
              <div class="col-sm-12 col-md-4 col-lg-4">
                <div class="form-group">
                  <label>Cliente</label>
                  <input type="text" ng-disabled="true"  ng-model="pedido.no_cliente" class="form-control" placeholder="no_cliente">
                </div>
              </div>
              
            </div>
            </div>

          <div class="row">
            <div class="col-sm-12 col-md-6 col-lg-6" style="display: none;">
              <div class="form-group">
                <label>Factura</label>
                <input type="text" ng-model="pedido.no_factu" class="form-control" placeholder="no_factura">
              </div>
            </div>
            <div class="col-sm-12 col-md-4 col-lg-4">
              <div class="form-group">
                <label>Fecha</label>
                <input type="date" ng-disabled="true" ng-model="pedido.fecha" class="form-control" placeholder="fecha">
              </div>
            </div>
            <div class="col-sm-12 col-md-8 col-lg-8">


              <div class="form-group">
                <label for="comment">Observacion:</label>
                <textarea class="form-control" ng-disabled="!editView" ng-model="pedido.observacion" rows="2" id="comment"></textarea>
              </div>
            </div>


          </div>
          
          <div class="row"  >
            
              <div class="col-sm-12 col-md-6 col-lg-6">
                <label for="clientes">Busqueda por producto</label>
                <div class="input-group mb-3">
                  <input type="text" class="form-control" ng-disabled="!editView" ng-model="busqueda_prod" placeholder="Busqueda por Producto" aria-label="Busqueda por Producto" aria-describedby="basic-addon2">
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary" ng-disabled="!editView"  ng-click="getProdNew(true)" type="button">Buscar</button>
                  </div>
                </div>
              
              </div>
              <div class="col-sm-12 col-md-6 col-lg-6" ng-show="productos.length > 0">
                <div class="form-group">
                  <label for="exampleFormControlSelect2">Seleccione un producto</label>
                  <select class="form-control" ng-disabled="!editView" ng-model="productIndex" id="exampleFormControlSelec2" ng-change="selectProduct()">
                    <option value="" disabled selected="selected" >Seleccione</option>
                    <option ng-repeat="x in productos" ng-if="!($index==1)" value="{{$index}}">{{x.nombre_producto}} - (<sub style="font-size: 6px;">{{ x.princ_activo.toLowerCase() }}</sub>) </option>
                  </select>
                </div>
              </div>
  
           
            

            
          </div>
          
          </div>
          <div class="container"   >
            <div class="row" >
              
              

                <div class="col-2">
                  <label>Codigo</label>
                  <input type="text" ng-disabled="true" ng-model="articulo.COD_PRODUCTO" class="form-control" placeholder="no_arti">
                </div>
                <div class="col-2">
                  <label>Cantidad</label>
                  <input type="number" ng-disabled="!editView" min="1" max="{{articulo.existencia}}" ng-model="articulo.CANTIDAD" class="form-control" placeholder="cantidad" onkeypress='return event.charCode >= 48 && event.charCode <= 57' >
                </div>
                <div class="col-2">
                  <label>Existencia</label>
                  <input type="text"ng-disabled="true" ng-model="articulo.existencia" class="form-control" placeholder="existencia">
                </div>
                <div class="col-3">
                  <label>Precio por unidad</label>
                  <span ng-if="editView">{{formato(2,(articulo.PRECIO)? articulo.PRECIO:0)}}</span>
                  <span ng-if="!editView">{{formato(2,0)}}</span>
                </div>
                <div class="col-3">
                  <label>Precio producto total</label>
                  <span ng-if="editView">{{formato(2,(articulo.PRECIO)? (articulo.PRECIO  * articulo.CANTIDAD):0)}}</span>
                  <span ng-if="!editView">{{formato(2,0)}}</span>
                </div>
                <div class="col-12">
                  <label></label>
                  <button type="button" ng-disabled="!editView" class="btn btn-success" style="margin-top: 32px;" ng-click="addArtPedido();">Agregar</button>
                </div>

            </div>
          
          </div>
          <div class="container" style="margin-top: 32px;">
            
            <div class="col-6 col-sm-6 col-md-6 col-lg-6">
              <label>Total (no incluye iva)</label>
              <h4>{{formato(2,totales.bolivares)}}</h4>
            </div>
            <div class="col-6 col-sm-6 col-md-6 col-lg-6" ng-show="productIndex != -1">
              <label>Nuevo Total </label>
              <h4> > {{ nuevoTotal() }}</h4>
            </div>
            
            <div class="form-group">
              <table class="table">
                  <thead>
                      <tr>
                      <th scope="col"><p class="text-center">#</p></th>
                      <th ng-if="editView" scope="col"><p class="text-center">Opcion</p></th>
                      <th scope="col"><p class="text-center">Codigo de Articulo</p></th>
                      <th scope="col"><p class="text-center">Cantidad</p></th>
                      <th scope="col"><p class="text-center">Precio por unidad</p></th>
                      <th scope="col"><p class="text-center">Total</p></th>
                      </tr>
                  </thead>
                  <tbody>
  
                      <tr ng-repeat="x in pedido.pedido">
                          <th scope="row">{{ $index + 1 }}</td>
                          <td ng-if="editView"> 
                            <!-- <button type="button" class="btn btn-danger" ng-click="removeArt($index);">X</button> -->
                            <p class="text-center">
                              <i class="fa fa-trash" style="cursor: pointer;" ng-click="removeArt($index);"></i>
                            </p>
                            
                            
                          </td>
                          <td><p class="text-center">{{ x.COD_PRODUCTO }}</p></td>
                          <td><p class="text-center">{{ x.CANTIDAD }}</p></td>
                          <td><p class="text-right">{{ formato(2,x.PRECIO) }}</p></td>
                          <td><p class="text-right">{{ formato(2,(x.PRECIO * x.CANTIDAD)) }}</p></td>
                        </tr>
                  </tbody>
                  </table>
  
            </div>
<!--   
            <div class="col-4 mb-5">
              <label></label>
              <button type="button"  class="btn btn-info" style="margin-top: 32px;" ng-click="addPedido();">Enviar pedido</button>
            </div> -->
  
          </div>
  
  
  
          </form>
  
        </div>
      </div>
      <div class="modal-footer" style="display: block;margin: 0 auto;">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" ng-click="reset();">Cerrar</button>
        <button type="button"  class="btn btn-primary" ng-show="!editView"  ng-click="editPedido();">Editar</button>
        <button type="button"  class="btn btn-success" ng-show="editView" ng-click="updPedido();">Actualizar pedido</button>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row" style="min-height:80vh">

    <div class="col-md-1 d-none d-sm-block" style="background:#069CDF">
      <br>
      <br>
      <div ng-include="'comps/common/sidebar.html'">
      </div>
    </div>
    <div class="col-md-11 col-sm-12">
      <br>
      <h5 class="text-center"> <strong>PEDIDOS </strong> </h5>
      <br>
      
      
      

      <div class="row">
        <!-- <div class="col-sm-12 d-none d-sm-block">

        </div> -->
        <div class="col-md-12">
          <button class="btn btn-primary" style="float: right; font-weight: bold;margin-bottom: 1rem;" ng-click="initModal();" data-toggle="modal" data-target="#addPedidoModal"> <i class="fas fa-pencil"></i> CREAR PEDIDO</button>
        </div>
        
        <div class="col-md-12">
			<!-- <table datatable="" dt-options="dtOptions" dt-columns="dtColumns" class="table table-striped table-bordered">
      </table> -->
      
      <table class="table">
        <thead>
            <tr>
            <th scope="col">#</th>
            <th scope="col">Opciones</th>
            <th scope="col">Número cia</th>
            <th scope="col">Grupo</th>
            <th scope="col">Número cliente</th>
            <th scope="col">Número factura</th>
            <th scope="col">Estatus</th>
            <th scope="col">Monto</th>
            <th scope="col">Cantidad de Productos</th>
            
            </tr>
        </thead>
        <tbody>

            <tr ng-repeat="x in listaPedidos">
                <th scope="row">{{ $index + 1 }}</td>
                <td> 
                  <!-- <button type="button" class="btn btn-danger" ng-click="removeArt($index);">X</button> -->
                  
                  <i class="fa fa-trash" style="cursor: pointer;" ng-click="removeArt(-1);"></i>
                  <i class="fa fa-eye" style="cursor: pointer;" ng-click="getPedido(x.ID);" data-toggle="modal" data-target="#showPedidoModal" ></i>
                </td>
                <td><p class="text-center">{{ x.no_cia }}</p></td>
                <td><p class="text-center">{{ x.grupo }}</p></td>
                <td><p class="text-center">{{ x.no_cliente }}</p></td>
                <td><p class="text-center">{{ x.no_factu }}</p></td>
                <td><p class="text-center">{{ x.estatus }}</p></td>
                <td><p class="text-right">{{ formato(2,x.precio) }}</p></td>
                <td><p class="text-center">{{ x.cantidad }}</p></td>
              </tr>
        </tbody>
        </table>
        </div>
      </div>

    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div ng-include="'comps/common/footer.html'">

      </div>
    </div>
  </div>
</div>
