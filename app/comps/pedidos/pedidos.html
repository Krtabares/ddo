<div ng-include="'comps/common/topbar.html'">

</div>

<div class="modal fade" id="addPedidoModal" tabindex="-1" role="dialog" aria-labelledby="addPedidoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background: #399CDF;color: white; font-weight: bold;">
        <h5 class="modal-title" id="addPedidoModalLabel">CREAR PEDIDO <i class="fas fa-1x fa-list-alt"></i></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
              <a class="nav-link " ng-class="{ active : tabsIndex == 0 }" ng-click="goToTab(0)" >Informacion Cliente <span class="badge badge-secondary">1</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" ng-class="{ active : tabsIndex == 1 }" ng-disabled="!showProductTable" ng-click="goToTab(1)" >Detalle de pedido <span class="badge badge-secondary">2</span></a>
            </li>
        </ul>


        <div class="modal-body-he">

          <form class="row col-sm-12 col-md-12 col-lg-12" >

            <div class="container" ng-show="tabsIndex == 0" >
              <!-- INFO CLIENTE -->
              <header-client></header-client>
              <!--  END INFO CLIENTE -->
              <div ng-show="!hasUserClient">
                <div class="row">
                  <div class="col-sm-12 col-md-6 col-lg-6">
                    <label for="clientes">Busqueda por cliente</label>
                    <div class="input-group mb-3">
                      <input type="text" id="clientes" class="form-control" ng-model="nombre_cliente" placeholder="Busqueda por Cliente" aria-label="Busqueda por Cliente" aria-describedby="basic-addon2">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary"  ng-click="getClientNew(true)" type="button">Buscar</button>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-12 col-md-6 col-lg-6" ng-show="clientes.length > 0" >
                    <div class="form-group">
                      <label for="exampleFormControlSelect1">Seleccione</label>
                      <select class="form-control" ng-model="clientIndex" id="exampleFormControlSelect1" ng-change="selectCLient()">
                        <option ng-repeat="x in clientes" value="{{$index}}">{{x.nombre_cliente}}</option>
                        <option value="" disabled selected>Seleccione un cliente</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="row pb-2 p-2" ng-if="clientIndex != -1">
                    <div class="col-md-6">
                        <p class="font-weight-bold mb-4">Informacion del Cliente </p>
                        <p class="mb-1" style="text-transform: capitalize;" >{{client.nombre_cliente.toLowerCase()}}</p>
                        <p>{{client.telefono1}}</p>
                        <p class="mb-1">{{client.direccion_cliente.toLowerCase()}}</p>
                    </div>

                    <div class="col-md-6 text-right">
                        <p class="font-weight-bold mb-4">Detalles</p>
                        <p class="mb-1"><span class="text-muted">Identificacion: </span> {{client.docu_identif_cliente}}</p>
                        <p class="mb-1"><span class="text-muted">Codigo: </span> {{client.cod_cliente}}</p>
                        <p class="mb-1" style="text-transform: capitalize;"><span class="text-muted">Encargado: </span> {{client.nombre_encargado.toLowerCase()}}</p>
                        <p class="mb-1" style="text-transform: capitalize;"><span class="text-muted">persona contacto área crédito y cobranzas: </span> {{client.v_persona_cyc.toLowerCase()}}</p>
                        <p class="mb-1"><span class="text-muted">Plazo de pago: </span> {{client.v_plazo}} dias</p>
                    </div>
                </div>

              </div>

            <div class="row">
              <div class="col-sm-12 col-md-6 col-lg-6" style="display: none;">
                <div class="form-group">
                  <label>Factura</label>
                  <input type="text" ng-model="pedido.no_factu" class="form-control" placeholder="no_factura">
                </div>
              </div>
              <div class="col-sm-12 col-md-4 col-lg-4">
                <div class="form-group">
                  <label>Fecha</label>
                  <input type="date" ng-disabled="true" ng-model="pedido.fecha" class="form-control" placeholder="fecha">
                </div>
              </div>
              <div class="col-sm-12 col-md-8 col-lg-8">


                <div class="form-group">
                  <label for="comment">Observacion:</label>
                  <textarea class="form-control" ng-model="pedido.observacion" rows="2" id="comment"></textarea>
                </div>
              </div>


            </div>


            </div>

            <div class="container" ng-show="tabsIndex == 1" >
              <div class="row mt-3 mb-5">


                <div class="col-4">
                  <label>Credito disponible Bs.S</label><br>
                  <span >{{formato(2,(creditoClient.disp_bs_format)? (creditoClient.disp_bs_format - totales.bsConIva):0)}}</span>

                </div>

                <div class="col-4">
                  <label>Credito disponible USD</label><br>
                  <span >{{formato(3,(creditoClient.disp_usd_format)? (creditoClient.disp_usd_format - totales.UsdConIva):0)}}</span>

                </div>

                <div class="col-4">
                  <label></label>
                  <button type="button" class="btn btn-success"  data-toggle="modal" data-target="#modalproduct">Agregar Productos</button>
                </div>

              </div>

              <div class="form-group" >
                <table class="table">
                    <thead>
                        <tr>
                        <!-- <th scope="col"><p class="text-center">#</p></th> -->
                        <th scope="col"><p class="text-center">Codigo de Articulo</p></th>
                        <th scope="col"><p class="text-center">Cantidad</p></th>
                        <th scope="col"><p class="text-center">Precio por unidad</p></th>
                        <th scope="col"><p class="text-center">Total</p></th>
                        <th scope="col"><p class="text-center">Opcion</p></th>
                        </tr>
                    </thead>
                    <tbody>

                        <tr ng-repeat="x in pedido.pedido">
                            <!-- <th scope="row">{{ $index + 1 }}</th> -->
                            <td><p class="text-center">{{ x.COD_PRODUCTO }}</p></td>
                            <td><p class="text-center">{{ x.CANTIDAD }}</p></td>
                            <td><p class="text-right">{{ formato(2,x.PRECIO) }}</p></td>
                            <td><p class="text-right">{{ formato(2,(x.PRECIO * x.CANTIDAD)) }}</p></td>
                            <td >
                              <!-- <button type="button" class="btn btn-danger" ng-click="removeArt($index);">X</button> -->
                              <!-- <p class="text-center">
                                <i class="fa fa-trash" style="cursor: pointer;" ng-click="removeArt($index);"></i>
                              </p>
                              -->
                              <button type="button" class="btn btn-danger" ng-click="removeArt($index);" ><i class="fa fa-trash" style="cursor: pointer;" ></i></button>
                            </td>
                          </tr>
                    </tbody>
                    </table>

              </div>

              <div class="row">
                <div class="col-lg-2 col-sm-5">
                  </div>
                    <div class="col-lg-6 col-sm-6 ml-auto">
                        <table class="table table-clear">
                            <tbody>
                                <tr>
                                    <td class="left">
                                        <strong class="text-dark">Total (no incluye iva)</strong>
                                    </td>
                                    <td class="right">{{formato(2,totales.bolivares)}}</td>
                                </tr>
                                <tr>
                                    <td class="left">
                                        <strong class="text-dark">Total (con iva)</strong>
                                    </td>
                                    <td class="right">{{formato(2,totales.bsConIva)}}</td>
                                </tr>
                                <tr>
                                    <td class="left">
                                        <strong class="text-dark">Total USD (no incluye iva)</strong>
                                    </td>
                                    <td class="right">{{formato(3,totales.USD)}}</td>
                                </tr>
                                <tr>
                                    <td class="left">
                                        <strong class="text-dark">Total USD (con iva)</strong> </td>
                                    <td class="right">
                                        <strong class="text-dark">{{formato(3,totales.UsdConIva)}}</strong>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


            </div>

          </form>

        </div>
      </div>
      <div class="modal-footer" style="display: block;margin: 0 auto;">
        <button type="button" class="btn btn-error" data-dismiss="modal" ng-click="reset();">Cerrar</button>
        <button type="button"  class="btn btn-success" ng-disabled="pedido.pedido.length < 1" ng-click="addPedido();">Enviar pedido</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="showPedidoModal" tabindex="-1" role="dialog" aria-labelledby="showPedidoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background: #399CDF;color: white; font-weight: bold;">
        <h5 class="modal-title" id="addPedidoModalLabel">VER PEDIDO <i class="fas fa-1x fa-list-alt"></i></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="card-header">
          Fecha:
          <strong>{{pedido.fecha}}</strong>
            <span class="float-right"> <strong>Estatus:</strong> {{pedido.estatus}}</span>

          </div>
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
              <a class="nav-link " ng-class="{ active : tabsIndex == 0 }" ng-click="goToTab(0)" >Informacion Cliente <span class="badge badge-secondary">1</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" ng-class="{ active : tabsIndex == 1 }" ng-disabled="!showProductTable" ng-click="goToTab(1)" >Detalle de pedido <span class="badge badge-secondary">2</span></a>
            </li>
        </ul>

        <div class="modal-body-he">


          <form class="col-sm-12 col-md-12 col-lg-12">

          <div class="container" ng-show="tabsIndex == 0"  >
            <header-client></header-client>
            <div ng-show="!hasUserClient">


              <div class="row pb-2 p-2" >
                  <div class="col-md-6">
                      <p class="font-weight-bold mb-4">Informacion del Cliente </p>
                      <p class="mb-1" style="text-transform: capitalize;" >{{client.nombre_cliente.toLowerCase()}}</p>
                      <p>{{client.telefono1}}</p>
                      <p class="mb-1">{{client.direccion_cliente.toLowerCase()}}</p>
                  </div>

                  <div class="col-md-6 text-right">
                      <p class="font-weight-bold mb-4">Detalles</p>
                      <p class="mb-1"><span class="text-muted">Identificacion: </span> {{client.docu_identif_cliente}}</p>
                      <p class="mb-1"><span class="text-muted">Codigo: </span> {{client.cod_cliente}}</p>
                      <p class="mb-1" style="text-transform: capitalize;"><span class="text-muted">Encargado: </span> {{client.nombre_encargado.toLowerCase()}}</p>
                      <p class="mb-1"><span class="text-muted">Plazo de pago: </span> {{client.v_plazo}} dias</p>
                  </div>
              </div>


            </div>

            <div class="row">
              <div  style="display: none;">
                <div class="form-group">
                  <label>Factura</label>
                  <input type="text" ng-model="pedido.no_factu" class="form-control" placeholder="no_factura">
                </div>
              </div>
              <div class="col-sm-12 col-md-4 col-lg-4" style="display: none;">
                <div class="form-group">
                  <label>Fecha</label>
                  <input type="date" ng-disabled="true" ng-model="pedido.fecha" class="form-control" placeholder="fecha">
                </div>
              </div>
              <div class="col-sm-12 col-md-12 col-lg-12">


                <div class="form-group">
                  <label for="comment">Observacion:</label>
                  <textarea class="form-control" ng-disabled="!editView" ng-model="pedido.observacion" rows="2" id="comment"></textarea>
                </div>
              </div>
            </div>


          <!-- </div> -->

          </div>

          <div class="container"  style="margin-top: 32px;" ng-show="tabsIndex == 1"  >

              <div class="row mt-5 mb-5">

                <div class="col-4">
                  <label>Credito disponible Bs.S</label><br>
                  <span >{{formato(2,(creditoClient.disp_bs_format)? (creditoClient.disp_bs_format - totales.bsConIva):0)}}</span>

                </div>

                <div class="col-4">
                  <label>Credito disponible USD</label><br>
                  <span >{{formato(3,(creditoClient.disp_usd_format)? (creditoClient.disp_usd_format - totales.UsdConIva):0)}}</span>

                </div>

                <div class="col-4">
                  <label></label>
                  <button type="button" ng-show="editView" class="btn btn-success" style="margin-top: 32px;" data-toggle="modal" data-target="#modalproduct">Agregar Productos</button>
                </div>

              </div>

            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
              <table class="table">
                  <thead>
                      <tr>
                      <th scope="col"><p class="text-center">#</p></th>
                      <th scope="col"><p class="text-center">Codigo de Articulo</p></th>
                      <th scope="col"><p class="text-center">Cantidad</p></th>
                      <th scope="col"><p class="text-center">Precio por unidad</p></th>
                      <th scope="col"><p class="text-center">Total</p></th>
                      <th ng-if="editView" scope="col"><p class="text-center">Opcion</p></th>
                      </tr>
                  </thead>
                  <tbody>

                      <tr ng-repeat="x in pedido.pedido">
                          <th scope="row">{{ $index + 1 }}</th>

                          <td><p class="text-center">{{ x.COD_PRODUCTO }}</p></td>
                          <td><p class="text-center">{{ x.CANTIDAD }}</p></td>
                          <td><p class="text-right">{{ formato(2,x.PRECIO) }}</p></td>
                          <td><p class="text-right">{{ formato(2,(x.PRECIO * x.CANTIDAD)) }}</p></td>
                          <td ng-if="editView">
                            <!-- <button type="button" class="btn btn-danger" ng-click="removeArt($index);">X</button> -->


                            <button type="button" class="btn btn-danger" ng-click="removeArt($index);" ><i class="fa fa-trash" style="cursor: pointer;" ></i></button>


                          </td>
                        </tr>
                  </tbody>
                  </table>

            </div>
            <div class="row">
              <div class="col-lg-2 col-sm-5">
                </div>
                  <div class="col-lg-6 col-sm-6 ml-auto">
                      <table class="table table-clear">
                          <tbody>
                              <tr>
                                  <td class="left">
                                      <strong class="text-dark">Total (no incluye iva)</strong>
                                  </td>
                                  <td class="right">{{formato(2,totales.bolivares)}}</td>
                              </tr>
                              <tr>
                                  <td class="left">
                                      <strong class="text-dark">Total (con iva)</strong>
                                  </td>
                                  <td class="right">{{formato(2,totales.bsConIva)}}</td>
                              </tr>
                              <tr>
                                  <td class="left">
                                      <strong class="text-dark">Total USD (no incluye iva)</strong>
                                  </td>
                                  <td class="right">{{formato(3,totales.USD)}}</td>
                              </tr>
                              <tr>
                                  <td class="left">
                                      <strong class="text-dark">Total USD (con iva)</strong> </td>
                                  <td class="right">
                                      <strong class="text-dark">{{formato(3,totales.UsdConIva)}}</strong>
                                  </td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
              </div>



          </div>



          </form>

        </div>
      </div>
      <div class="modal-footer" style="display: block;margin: 0 auto;">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" ng-click="reset();">Cerrar</button>
        <button type="button"  class="btn btn-primary" ng-show="!editView"  ng-click="editPedido();">Editar</button>
        <button type="button"  class="btn btn-success" ng-disabled="pedido.pedido.length < 1" ng-show="editView" ng-click="updPedido();">Actualizar pedido</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalproduct">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Productos</h4>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

        </div>
        <div class="modal-body">
          <div class="container">
            <div id="infoProduct" class="row" >


                <div class="col-4">
                  <label>Codigo</label><br>
                  <span >{{articulo.COD_PRODUCTO}}</span>
                </div>
                <div class="col-4">
                  <label>Existencia</label><br>
                  <span >{{articulo.existencia}}</span>
                </div>
                <div class="col-4">
                  <label>Cantidad</label>
                  <input type="number"  min="1" max="{{articulo.existencia}}" ng-model="articulo.CANTIDAD" class="form-control" placeholder="cantidad" onkeypress='return event.charCode >= 48 && event.charCode <= 57' >
                </div>

                <!-- <div class="col-12">
                  <label></label>
                  <button type="button" ng-disabled="productIndex==-1" class="btn btn-success" style="margin-top: 32px;" ng-click="addArtPedido();">Agregar</button>
                </div> -->

                <div class="row col-sm-12 col-md-12 col-lg-12">
                  <div class="mt-3 ">

                    <label>Precios</label>
                  </div>
                  <div class="col-3">
                    <label>Por unidad Bs.S</label><br>
                    <span >{{formato(2,(articulo.PRECIO)? articulo.PRECIO:0)}}</span>

                  </div>
                  <div class="col-3">
                    <label>Total Bs.S</label><br>
                    <span >{{formato(2,(articulo.PRECIO)? (articulo.PRECIO  * articulo.CANTIDAD):0)}}</span>

                  </div>
                  <div class="col-3">
                    <label>Por unidad USD</label><br>
                    <span >{{formato(3,(articulo.precio_usd)? articulo.precio_usd:0)}}</span>

                  </div>
                  <div class="col-3">
                    <label>Total USD</label><br>
                    <span >{{formato(3,(articulo.precio_usd)? (articulo.precio_usd  * articulo.CANTIDAD):0)}}</span>

                  </div>
                </div>

            </div>
          </div>

          <div class="modal-body-he">

            <div class="container">

              <div class="col-sm-12 col-md-12 col-lg-12">
                <label for="clientes">Busqueda por producto</label>
                <div class="input-group mb-3">
                  <input type="text" class="form-control"   ng-model="busqueda_prod" placeholder="Busqueda por Producto" aria-label="Busqueda por Producto" aria-describedby="basic-addon2">
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary"   ng-click="getProdNew(true)" type="button">Buscar</button>
                  </div>
                </div>

                <div ng-if="showProductTable" >

                  <table datatable="ng" dt-options="dtOptionsProd"  class="table table-striped table-bordered" >
                    <thead>
                        <tr>
                        <th scope="col"><p class="text-center">#</p></th>
                        <th scope="col"><p class="text-center">Nombre Producto</p></th>
                        <th scope="col"><p class="text-center">Existencia</p></th>
                        <th scope="col"><p class="text-center">Principio Activo</p></th>
                        <th scope="col"><p class="text-center">Precio Bs.S</p></th>
                        <th scope="col"><p class="text-center">Iva Bs.S</p></th>
                        <th scope="col"><p class="text-center">Precio USD</p></th>
                        <th scope="col"><p class="text-center">Iva USD</p></th>
                        <th scope="col"><p class="text-center">Proveedor</p></th>
                        </tr>
                    </thead>
                    <tbody>
                      <a href="#infoProduct">
                        <tr ng-repeat="x in productos" ng-click="selectProduct($index)" ng-class="{ selectedRow : $index == productIndex }" >

                            <td><p class="text-center">{{ $index + 1 }}</p></td>
                            <td><p class="text-center">{{ x.nombre_producto }}</p></td>
                            <td><p class="text-center">{{ x.existencia }}</p></td>
                            <td><p class="text-center">{{ x.princ_activo }}</p></td>
                            <td><p class="text-right">{{  x.precioFormatVE }}</p></td>
                            <td><p class="text-right">{{  x.iva_bs }}</p></td>
                            <td><p class="text-right">{{  x.precioFormatUSD }}</p></td>
                            <td><p class="text-right">{{  x.iva_usd }}</p></td>
                            <td><p class="text-right">{{  x.proveedor }}</p></td>

                        </tr>
                        </a>

                    </tbody>
                    </table>
                </div>


            </div>

            </div>
          </div>


        </div>
        <div class="modal-footer">

          <button type="button" class="btn btn-error" data-dismiss="modal">Cerrar</button>
          <button type="button" ng-disabled="productIndex==-1" class="btn btn-success" style="margin-top: 32px;" ng-click="addArtPedido();">Agregar</button>
        </div>
      </div>
    </div>
  </div>


<div class="modal fade" id="modalConfirm">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Confirmacion</h4>
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

      </div>
      <div class="modal-body">

        <div class="container">

          <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
              <h3><p class="text-center">Desea eliminar el registro?</p></h3>
          </div>

        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-danger" ng-click="delPedido()" data-dismiss="modal">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<div id="wrapper" class="active">

  <my-sidebar></my-sidebar>
  <div id="page-content-wrapper" class="container-fluid">
    <div class="row" style="min-height:80vh">

      <div class="col-md-12 col-sm-12">
        <br>
        <h5 class="text-center"> <strong>PEDIDOS </strong> </h5>
        <br>

        <header-client></header-client>

        <div class="row">
          <!-- <div class="col-sm-12 d-none d-sm-block">

          </div> -->
          <div class="col-md-12">
            <button class="btn btn-primary" style="float: right; font-weight: bold;margin-bottom: 1rem;" ng-click="initModal();" data-toggle="modal" data-target="#addPedidoModal"> <i class="fas fa-pencil"></i> CREAR PEDIDO</button>
          </div>

          <div class="col-md-12">
  			<!-- <table datatable="" dt-options="dtOptions" dt-columns="dtColumns" class="table table-striped table-bordered">
        </table> -->

        <table class="table" datatable="ng" dt-options="dtOptions">
          <thead>
              <tr>
              <th scope="col"><p class="text-center">#</p></th>
              <!-- <th scope="col"><p class="text-center">Número cia</p></th>
              <th scope="col"><p class="text-center">Grupo</p></th> -->
              <th scope="col"><p class="text-center">Número Cliente</p></th>
              <th scope="col"><p class="text-center">Número Pedido</p></th>
              <th scope="col"><p class="text-center">Estatus</p></th>
              <th scope="col"><p class="text-center">Monto</p></th>
              <th scope="col"><p class="text-center">Cantidad de Productos</p></th>
              <th scope="col"><p class="text-center">Opciones</p></th>

              </tr>
          </thead>
          <tbody>

              <tr ng-repeat="x in listaPedidos">
                  <th scope="row">{{ $index + 1 }}</th>
                  <!-- <td><p class="text-center">{{ x.no_cia }}</p></td>
                  <td><p class="text-center">{{ x.grupo }}</p></td> -->
                  <td><p class="text-center">{{ x.no_cliente }}</p></td>
                  <td><p class="text-center">{{ x.no_factu }}</p></td>
                  <td><p class="text-center">{{ x.estatus }}</p></td>
                  <td><p class="text-right">{{ formato(2,x.precio) }}</p></td>
                  <td><p class="text-center">{{ x.cantidad }}</p></td>
                  <td>
                    <!-- <button type="button" class="btn btn-danger" ng-click="removeArt($index);">X</button> -->

                    <!-- <button type="button" class="btn btn-danger" ></button> -->
                    <i class="fa fa-trash" style="cursor: pointer;" data-toggle="modal" data-target="#modalConfirm" ng-click="confirmModal(x.ID);"  ></i>


                    <!-- <button type="button" class="btn btn-default"  ></button> -->
                    <i class="fa fa-eye" style="cursor: pointer;" ng-click="getPedido(x.ID);" data-toggle="modal" data-target="#showPedidoModal"  ></i>


                  </td>
                </tr>
          </tbody>
          </table>
          </div>
        </div>

      </div>
    </div>


  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <div ng-include="'comps/common/footer.html'">

    </div>
  </div>
</div>
